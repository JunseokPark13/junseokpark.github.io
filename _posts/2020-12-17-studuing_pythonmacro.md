---
title: '[Python] 네이버 카페에 덧글 달아주는 매크로 제작기 - 1'
author: Bandito
date: 2020-12-17 20:40:00 +0900
categories: [Study, Python]
tags: [Python, toy]
toc: false
comment: true
---

## - 서문
***
우리가 물건을 사기 위해서는 생산자가 만든 물품을 판매자를 거쳐 구매를 하게 된다는 사실은 대한민국의 의무교육 과정을 거쳤다면 누구든 알 수 있는 사실이다.  
<br/>
하지만 수많은 중간 도매상을 거쳐 마트에서 판매되는 것이기 때문에 소비자가 구매하는 실질적인 가격은 생산자가 물건을 도매상에게 판매할 때 보다 높아질 수 밖에 없다.  
<br/>
현대 사회에서는 인터넷 거래로 이러한 중간 과정을 해소하여 생산자는 도매상에게 팔 때 보다 높은 가격을 부를 수 있고, 소비자는 일반 소비자 판매가보다 싼 값에 물건을 구매할 수 있다.  
<br/>
현명한 소비를 위해서 이런 인터넷 거래를 잘 활용하는 것은 반 필수적인 사회가 되고있다.

우리 아버지가 자주 들르시는 이런 인터넷 거래 카페가 있다. 이 카페에서는 매 주 수요일 8시에 어떤 축산업자가 고기를 매우 싸게 파는 글을 올린다.   
이 글에 선착순으로 댓글을 달면 물품을 구입할 수 있는 자격을 얻을 수 있다. 하지만...      
이 주간 판매글은 엄청나게 인기가 있어서 글이 작성되자마자 들어가 댓글을 단다 하더라도 순위 권 내에 드는 것은 매우 어려운 일이다.   

나는 이걸 매크로로 해결하면 어떨까? 라는 생각을 하게 되었다.   

그런데 아무리 검색해도 이런 매크로 프로그램을 다운받거나, 만드는 방법을 쉽게 정리해놓은 글이 별로 없었다. 이유는 간단했다.. 너무나도 악용되기 쉬운 프로그램이라는 점   

애초에 크롤링이라는 것 자체를 허용하지 않는 웹사이트가 많다. 많은 사무직 사람들이 자신만의 크롤러를 만들어서 원하는 정보를 쉽게 모으고 싶어하지만, 이를 상업적으로 사용하는 것은 불법이라는 실제 판결 [사례](http://news.bizwatch.co.kr/article/mobile/2017/09/27/0023){: target="_blank"}도 있다.   


그럼 매크로는 오죽할까. 악의적인 사용자들이 지속적으로 광고성 댓글을 모든 글에 달아댄다면 당연히 문제가 발생할 것이다.   

그래서 나는 이에 관련된 프로젝트를 진행하거나 포스팅하는 것에 대해 조금 불안함을 느끼고 있다.   
실제로 사용할지는 모르겠지만.. 재미삼아 만든다고 생각하자    
<br/><br/><br/>

## - 내가 만들고자 하는 것
***
우선적으로는 내가 원하는 글이 작성되자마자 해당 글에 접속하여 덧글을 다는 매크로를 구상 중에 있다.   
내가 매크로를 시간에 맞춰 직접 가동한다고 했을 때, 매크로에서는 글의 작성자를 체크하거나 제목을 체크하여 조건에 맞는 게시물이 작성된다면, 바로 접속하고 덧글 칸을 찾아 아무런 내용이나 입력 후 덧글 작성 버튼을 누르게 하면 된다.   
어떻게든 조건에 맞는 글을 찾아 빠르게 덧글을 작성하는 것이 관건이다.


## - 준비물
***
우선은 파이썬의 크롤링에 대해 알아봤다. 일반적으로 크롤링을 하려면 BeautifulSoup 라는 라이브러리를 활용한다고 한다.   
단순 크롤링이라면 이 쯤으로 해결되겠지만 난 실제로 내가 웹 페이지에 관여를 하고 싶다. 이럴 때는 selenium 이라는 파이썬 패키지를 사용해야한다고 한다.   
다음은 웹 드라이버를 결정해야 하는데, 나는 구글 크롬을 사용할 것이므로 chromdriver 를 다운받기로 했다.   

크롬의 웹 드라이버는 이 [사이트](https://sites.google.com/a/chromium.org/chromedriver/downloads){: target="_blank"}에서 다운받을 수 있다.   
주의해야 할 점은, 다운받는 **웹 드라이버의 버전**과 **크롬의 버전**이 일치해야 한다는 것   

다운로드를 다 받았다면 해당 파일을 작성하려는 파이썬 파일이 있는 폴더에 넣자. 물론 다른 위치에 두어도 상관은 없지만, 그러면 경로설정을 해 주어야 하니 나는 귀찮아서 같은 폴더에 두었다.   

필요한 라이브러리는 다음 명령어로 설치할 수 있다.
```
pip install beautifulsoup4 // BeautifulSoup 설치
pip install selenium // selenium 설치
```

## - 제작 과정
***

### Import
```python
from urllib.request import urlopen  # 주소를 열기 위해 사용
from urllib.parse import quote_plus # 문자를 url에 알맞은 형태로 치환하기 위해 사용
from bs4 import BeautifulSoup  
from selenium import webdriver
import time  # 시간 관련 함수 사용을 위함
```
일단 필요한 라이브러리를 가져와야 한다.
quote_plus 는 아직 사용할 계획에는 없지만.. 나중에 기능을 다듬을 때 쓸 수도 있을 것 같아 일단 적어봤다

### 웹 드라이버 불러오기
```python
driver = webdriver.Chrome('chromedriver.exe')
```
그리고 웹 드라이버를 연결해주어야 한다. 여기서 파이썬 파일과 드라이버가 같은 폴더에 있다면 위와 같이 입력해도 되지만, 그렇지 않다면 경로를 직접 적어주면 된다.
앞으로는 저 driver 변수로 여러가지 메소드를 사용할 것이다.

### 웹 페이지 접속하기
```python
id = "ID" # 자신의 아이디
pw = "PASSWORD" #자신의 비밀번호

driver.get('https://cafe.naver.com/XXXXXXXXXXX')
driver.find_element_by_name('id').send_keys(id)
driver.find_element_by_name('pw').send_keys(pw)

driver.find_element_by_xpath('//*[@id="log.login"]').click()
```
다음은 get을 사용하여 접속하고자 하는 사이트의 링크를 정한다. 실제 사용할 때는 저 XXXX.. 에 들어가고자 하는 카페의 url 번호를 적으면 된다.   

테스트 용으로 사용할 카페는 비공개 회원제이므로 회원이 아니면 접속할 수 없다. 때문에 바로 로그인 화면으로 넘어가게 되는데, 실제로 공개된 카페에서 사용하기 위해서는 로그인 페이지를 직접 찾아가는 코드도 작성해야 할 것 같다.   

로그인 페이지에서 id 와 pw 에 해당하는 칸을 찾아 지정된 변수를 입력하게 하고   
로그인 버튼을 지정하여 클릭하게 한다.

칸을 지정하는 방법은 여러가지가 있지만, 나는 id와 xpath 를 사용하여 찾는 방법을 썼다.   
![Alt text](/assets/img/posting/f12_1.PNG)
구글 크롬이라면 f12 를 눌러 개발자 모드를 켠다.   
사진에 빨간색으로 동그라미 친 버튼을 누른 뒤 페이지의 요소들을 클릭하면 해당 요소의 html 코드를 확인할 수 있다.   

xpath 를 알고 싶다면 하이라이팅 된 html 코드에 우클릭 > Copy > Copy Xpath 를 선택하면 자동으로 클립보드에 복사가 된다.   

이런식으로 로그인을 시도하면   
![Alt text](/assets/img/posting/macroblock.PNG)
<br/>

어이쿠 이런 매크로 방지 페이지가 나와버린다

지금은 이를 회피하기 위해 execute_script을 통해 자바스크립트로 아이디와 패스워드를 입력하는 것이 가능하다고는 하는데.. 이 또한 막힐 수도 있다.    
일단은 자동으로 로그인을 하기 위해 코드를 좀 변경하였다.

```python
id = "ID" # 자신의 아이디
pw = "PASSWORD" #자신의 비밀번호

driver.get('https://cafe.naver.com/XXXXXXXXXXX')

driver.execute_script("document.getElementsByName('id')[0].value = \'" + id + "\'")
time.sleep(1)
driver.execute_script("document.getElementsByName('pw')[0].value=\'" + pw + "\'")
time.sleep(1)
# 매크로 탐지를 회피하기 위한 자바스크립트 사용
driver.find_element_by_xpath('//*[@id="log.login"]').click()
```

이렇게 바꿔주면 로그인까지는 제대로 진행이 가능하다.

![Alt text](/assets/img/posting/cafemain.PNG)
<br/>

테스트를 위해 임의로 제작한 카페이다. 여기를 통해서 여러가지 테스트를 해보고자 한다..   

<br/><br/>

후.. 블로그 포스팅이란게 정말 힘든 것 같다. 혼자 만드는건 이것 저것 해보면서 뚝딱뚝딱 시간을 낭비할 수 있는데, 포스팅을 할려면 어떤 말을 적을지부터가 고민이다... 샤워하면서 밥먹으면서 어떤 식으로 적어볼까 하고 생각하는 시간이 많아졌다.   

재미는 있지만 시간이 너무 많이 든다는 것이 흠이다. 이 것도 언젠가는 익숙해지겠지
